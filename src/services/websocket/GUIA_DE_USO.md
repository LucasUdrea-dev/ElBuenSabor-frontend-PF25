# üéØ Gu√≠a de Uso - ¬øCu√°ndo usar qu√©?

## üìä Comparaci√≥n de M√©todos

| M√©todo | Cu√°ndo Usar | Complejidad | Caracter√≠sticas |
|--------|-------------|-------------|-----------------|
| **usePedidoWebSocket** | Dashboards que necesitan mostrar lista de pedidos | ‚≠ê F√°cil | Gesti√≥n completa, historial, cambio de estado |
| **usePedidoNotificacion** | Solo mostrar notificaciones al usuario | ‚≠ê Muy F√°cil | Solo callback, sin historial |
| **useWebSocketConexion** | Solo mostrar estado de conexi√≥n | ‚≠ê Muy F√°cil | Solo conexi√≥n, sin notificaciones |
| **PedidoWebSocketService** | Control total y personalizado | ‚≠ê‚≠ê‚≠ê Avanzado | M√°xima flexibilidad |

---

## üé® Casos de Uso por Dashboard

### 1Ô∏è‚É£ Dashboard de Administrador

**Necesita:**
- Ver TODOS los pedidos
- Cambiar estados
- Filtrar por sucursal/estado
- Estad√≠sticas en tiempo real

**Usar:**
```tsx
const { conectado, notificaciones, cambiarEstado } = usePedidoWebSocket({ 
  tipo: 'admin' 
});
```

**Por qu√©:**
- Necesita historial completo
- Necesita cambiar estados
- Necesita ver todas las actualizaciones

---

### 2Ô∏è‚É£ Dashboard de Cocina

**Necesita:**
- Ver pedidos de SU sucursal
- Cambiar estados (Pendiente ‚Üí En Preparaci√≥n ‚Üí Listo)
- Organizar por columnas (Pendientes, En Preparaci√≥n)

**Usar:**
```tsx
const sucursalId = 1; // De contexto o props
const { notificaciones, cambiarEstado } = usePedidoWebSocket({ 
  tipo: 'sucursal', 
  sucursalId 
});

// Filtrar localmente
const pendientes = notificaciones.filter(n => n.estadoId === EstadoPedido.PENDIENTE);
const enPreparacion = notificaciones.filter(n => n.estadoId === EstadoPedido.EN_PREPARACION);
```

**Por qu√©:**
- Solo ve pedidos de su sucursal
- Necesita cambiar estados
- Necesita organizar pedidos

---

### 3Ô∏è‚É£ Dashboard de Delivery

**Necesita:**
- Ver pedidos LISTOS de SU sucursal
- Cambiar estados (Listo ‚Üí En Camino ‚Üí Entregado)
- Ver pedidos que est√° entregando

**Usar:**
```tsx
const sucursalId = 1;
const { notificaciones, cambiarEstado } = usePedidoWebSocket({ 
  tipo: 'sucursal', 
  sucursalId 
});

// Filtrar solo los relevantes para delivery
const listos = notificaciones.filter(n => n.estadoId === EstadoPedido.LISTO);
const enCamino = notificaciones.filter(n => n.estadoId === EstadoPedido.EN_CAMINO);
```

**Por qu√©:**
- Solo ve pedidos de su sucursal
- Necesita cambiar estados
- Necesita filtrar por estados relevantes

---

### 4Ô∏è‚É£ Vista de Cliente

**Necesita:**
- Ver SUS propios pedidos
- Recibir notificaciones
- NO puede cambiar estados

**Opci√≥n A - Con historial:**
```tsx
const usuarioId = obtenerUsuarioLogueado();
const { notificaciones } = usePedidoWebSocket({ 
  tipo: 'usuario', 
  usuarioId 
});

// Mostrar lista de pedidos del usuario
```

**Opci√≥n B - Solo notificaciones:**
```tsx
const usuarioId = obtenerUsuarioLogueado();
usePedidoNotificacion(
  { tipo: 'usuario', usuarioId },
  (notificacion) => {
    toast.success(`Tu pedido #${notificacion.pedidoId} est√° ${notificacion.estadoNombre}`);
  }
);
```

**Por qu√©:**
- Opci√≥n A: Si necesitas mostrar lista de pedidos
- Opci√≥n B: Si solo necesitas notificar cambios

---

### 5Ô∏è‚É£ Indicador de Conexi√≥n en Navbar

**Necesita:**
- Solo mostrar si est√° conectado o no
- Bot√≥n para reconectar

**Usar:**
```tsx
const { conectado, conectar } = useWebSocketConexion();

return (
  <div>
    {conectado ? 'üü¢' : 'üî¥'}
    {!conectado && <button onClick={conectar}>Reconectar</button>}
  </div>
);
```

**Por qu√©:**
- No necesita notificaciones
- Solo necesita estado de conexi√≥n

---

## üîÑ Flujos de Trabajo Comunes

### Flujo 1: Pedido Nuevo ‚Üí Entregado

```
1. Cliente hace pedido
   ‚îî‚îÄ> Backend crea pedido con estado PENDIENTE
       ‚îî‚îÄ> WebSocket notifica a:
           ‚îú‚îÄ> Dashboard Admin
           ‚îú‚îÄ> Dashboard Cocina (sucursal X)
           ‚îî‚îÄ> Cliente (usuario Y)

2. Cocinero ve pedido en "Pendientes"
   ‚îî‚îÄ> Hace clic en "Comenzar Preparaci√≥n"
       ‚îî‚îÄ> cambiarEstado(pedidoId, EstadoPedido.EN_PREPARACION)
           ‚îî‚îÄ> WebSocket env√≠a a backend
               ‚îî‚îÄ> Backend actualiza BD
                   ‚îî‚îÄ> WebSocket notifica a todos

3. Cocinero termina pedido
   ‚îî‚îÄ> Hace clic en "Marcar Listo"
       ‚îî‚îÄ> cambiarEstado(pedidoId, EstadoPedido.LISTO, "15 minutos")
           ‚îî‚îÄ> WebSocket env√≠a a backend
               ‚îî‚îÄ> Backend actualiza BD
                   ‚îî‚îÄ> WebSocket notifica a todos
                       ‚îî‚îÄ> Dashboard Delivery recibe alerta

4. Delivery toma pedido
   ‚îî‚îÄ> Hace clic en "Tomar Pedido"
       ‚îî‚îÄ> cambiarEstado(pedidoId, EstadoPedido.EN_CAMINO)
           ‚îî‚îÄ> Cliente recibe notificaci√≥n "Tu pedido est√° en camino"

5. Delivery entrega pedido
   ‚îî‚îÄ> Hace clic en "Marcar Entregado"
       ‚îî‚îÄ> cambiarEstado(pedidoId, EstadoPedido.ENTREGADO)
           ‚îî‚îÄ> Cliente recibe notificaci√≥n "Tu pedido ha sido entregado"
```

---

## üéØ Decisi√≥n R√°pida

### ¬øNecesitas mostrar LISTA de pedidos?
‚Üí **usePedidoWebSocket**

### ¬øSolo necesitas NOTIFICAR al usuario?
‚Üí **usePedidoNotificacion**

### ¬øSolo necesitas mostrar ESTADO DE CONEXI√ìN?
‚Üí **useWebSocketConexion**

### ¬øNecesitas CONTROL TOTAL?
‚Üí **PedidoWebSocketService**

---

## üìù Plantillas de C√≥digo

### Plantilla 1: Dashboard B√°sico

```tsx
import { usePedidoWebSocket, EstadoPedido } from './services/websocket';

function MiDashboard() {
  const { conectado, notificaciones, cambiarEstado, error } = usePedidoWebSocket({
    tipo: 'admin' // Cambiar seg√∫n necesidad
  });

  if (error) {
    return <div>Error: {error.message}</div>;
  }

  return (
    <div>
      <header>
        <h1>Dashboard</h1>
        <span>{conectado ? 'üü¢ Online' : 'üî¥ Offline'}</span>
      </header>

      <div className="pedidos">
        {notificaciones.map(pedido => (
          <div key={pedido.pedidoId}>
            <h3>Pedido #{pedido.pedidoId}</h3>
            <p>Estado: {pedido.estadoNombre}</p>
            {/* Botones seg√∫n estado */}
          </div>
        ))}
      </div>
    </div>
  );
}
```

### Plantilla 2: Notificaciones para Cliente

```tsx
import { usePedidoNotificacion } from './services/websocket';

function App() {
  const usuarioId = obtenerUsuarioLogueado();

  if (usuarioId) {
    usePedidoNotificacion(
      { tipo: 'usuario', usuarioId },
      (notificacion) => {
        // Mostrar notificaci√≥n
        toast.success(`Pedido #${notificacion.pedidoId} - ${notificacion.estadoNombre}`);
      }
    );
  }

  return <div>{/* Tu app */}</div>;
}
```

### Plantilla 3: Dashboard con Filtros

```tsx
import { usePedidoWebSocket, EstadoPedido } from './services/websocket';
import { useState } from 'react';

function DashboardConFiltros() {
  const { notificaciones, cambiarEstado } = usePedidoWebSocket({ tipo: 'admin' });
  const [filtro, setFiltro] = useState<number | null>(null);

  const pedidosFiltrados = filtro 
    ? notificaciones.filter(n => n.estadoId === filtro)
    : notificaciones;

  return (
    <div>
      <div className="filtros">
        <button onClick={() => setFiltro(null)}>Todos</button>
        <button onClick={() => setFiltro(EstadoPedido.PENDIENTE)}>Pendientes</button>
        <button onClick={() => setFiltro(EstadoPedido.EN_PREPARACION)}>En Preparaci√≥n</button>
        {/* M√°s filtros */}
      </div>

      <div className="pedidos">
        {pedidosFiltrados.map(pedido => (
          <div key={pedido.pedidoId}>
            {/* Renderizar pedido */}
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

## ‚ö†Ô∏è Errores Comunes

### Error 1: "No hay conexi√≥n WebSocket"

**Causa:** Intentar usar el servicio antes de conectar

**Soluci√≥n:** El hook `usePedidoWebSocket` conecta autom√°ticamente. Si usas el servicio directo, llama a `connect()` primero.

```tsx
// ‚ùå Mal
pedidoWebSocketService.cambiarEstado(1, 2); // Error!

// ‚úÖ Bien
await pedidoWebSocketService.connect();
pedidoWebSocketService.cambiarEstado(1, 2);

// ‚úÖ Mejor - Usa el hook
const { cambiarEstado } = usePedidoWebSocket({ tipo: 'admin' });
cambiarEstado(1, 2); // Funciona autom√°ticamente
```

### Error 2: M√∫ltiples suscripciones

**Causa:** Crear m√∫ltiples suscripciones al mismo topic

**Soluci√≥n:** Usa el hook que gestiona autom√°ticamente las suscripciones

```tsx
// ‚ùå Mal - Crea nueva suscripci√≥n en cada render
useEffect(() => {
  pedidoWebSocketService.suscribirseAPedidos(callback);
}, []); // Falta cleanup!

// ‚úÖ Bien - Usa el hook
const { notificaciones } = usePedidoWebSocket({ tipo: 'admin' });
```

### Error 3: No recibo notificaciones

**Causa:** ID incorrecto de sucursal o usuario

**Soluci√≥n:** Verifica que el ID sea correcto

```tsx
// ‚ùå Mal
const { notificaciones } = usePedidoWebSocket({ 
  tipo: 'sucursal', 
  sucursalId: undefined // ¬°Error!
});

// ‚úÖ Bien
const sucursalId = obtenerSucursalActual(); // Funci√≥n que retorna ID v√°lido
const { notificaciones } = usePedidoWebSocket({ 
  tipo: 'sucursal', 
  sucursalId 
});
```

---

## üîç Debug

### Habilitar Logs

```tsx
const { ... } = usePedidoWebSocket(
  { tipo: 'admin' },
  { debug: true } // Muestra logs en consola
);
```

### Logs que ver√°s:

```
[PedidoWebSocketService] ‚úÖ Conectado al WebSocket
[PedidoWebSocketService] ‚úÖ Suscrito a /topic/pedidos/admin
[PedidoWebSocketService] üì® Notificaci√≥n recibida de /topic/pedidos/admin: {...}
[PedidoWebSocketService] üì§ Cambio de estado enviado: {...}
```

---

## üìö Recursos

- **WEBSOCKET_GUIA_COMPLETA.md** - Gu√≠a detallada
- **WEBSOCKET_QUICK_START.md** - Inicio r√°pido
- **WEBSOCKET_RESUMEN.md** - Resumen ejecutivo
- **src/services/websocket/README.md** - Documentaci√≥n t√©cnica
- **src/services/websocket/ejemplos/** - Ejemplos completos

---

## ‚úÖ Checklist de Implementaci√≥n

- [ ] Decidir qu√© hook usar seg√∫n necesidad
- [ ] Importar el hook correcto
- [ ] Configurar tipo de suscripci√≥n
- [ ] Renderizar notificaciones en UI
- [ ] Implementar cambios de estado (si aplica)
- [ ] Agregar indicador de conexi√≥n
- [ ] Manejar errores
- [ ] Probar con backend corriendo
- [ ] Agregar estilos CSS
- [ ] Implementar filtros (si aplica)

---

**¬°Ahora sabes exactamente qu√© usar en cada situaci√≥n!** üéâ
